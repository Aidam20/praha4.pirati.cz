---
layout: default_map
title: Mapa pirátských plánů pro Pardubice
---

<div id="map"></div>

    <link rel="stylesheet" href="css/leaflet.css"/>
    <link rel="stylesheet" href="css/leaflet-search.css"/>    
    <link rel="stylesheet" href="css/datamap.css"/> 

    <script src="js/url-polyfill.js"></script>
    <script src="js/polyfill.js"></script>
    <script src="js/ie11CustomProperties.js"></script>         
    <script src="js/datamap.js"></script>

<script>
    // initialize Leaflet
    var zmap = L.map('map').setView({lon: 0, lat: 0}, 2);

    // add the OpenStreetMap tiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap contributors</a>'
      }).addTo(zmap);

    // show the scale bar on the lower left corner
    L.control.scale().addTo(zmap);
    
    // vytvorim si vlastni vrstvu


title = 'Denní Obsazenost 201911 (Bdata v % z projektované kapacity)';
XTitle = 'Obsazenost 201911 Den(B)';
colors = ['#ffff00','#ffff93','#ffffd4','#fffff4','#ffc4b0','#ff9b7e','#ff603e','#ff0000'];
grades = [30,50,70,80,90,100,130];
labels = [];
XMC = 'P04';
SrcData = 'P04-201911B_4.tsv';
clat = 50.039871471896;
clon = 14.440822135499;
HelpFile = '/help/OBNA.help';
HelpLegendFile = '/help/OBNAL.help';
max_popup_width=200;

      // initialize the map
      var map = L.map('map').setView([50.097, 14.37], 15); //,{zoomControl: false}

      var GeoData = '';
      var GeoDataFile = '';
      GeoData = '/puzzle/genmaps/P04/OB_201911D_NA';
      if (GeoData === '') {
        title = '&nbsp;&nbsp;Neexistující mapa. Tu jste asi vidět nechtěli...&nbsp;&nbsp;';
        GeoData = 'nonexist';
        window.setTimeout(function () {
          window.location = '/';
        }, 10000);
      }
      GeoDataFile = GeoData + '.json';
      GeoDataSource = GeoData + '.tsv';
      GeoDataPath = (GeoData.substr(0, GeoData.lastIndexOf("/") + 1));


      var PTitle = getURLParameter("PTitle");
      if (PTitle != null)
        changeTitle(PTitle);

      /*var layers_switch = L.control({position: 'bottomleft'});
       layers_switch.onAdd = function (map) {
       var div = L.DomUtil.create('div', 'nazdar');
       var content = '';
       content += '<button id="Useky" title="Přesune vrstvu Useky do popředí">Useky</button>';
       content += '<button id="ZTPRZ" title="Přesune vrstvu ZTPRZ do popředí">ZTPRZ</button>';
       content += '<button id="ZTPPUB" title="Přesune vrstvu ZTPPUB do popředí">ZTPPUB</button>';
       content += '<button id="ZAKAZ" title="Přesune vrstvu ZAKAZ do popředí">ZAKAZ</button>';
       content += '<button id="SPEC" title="Přesune vrstvu SPEC do popředí">SPEC</button>';
       content += '<button id="ZAS" title="Přesune vrstvu ZAS do popředí">ZAS</button>';
       content += '<button id="EXT" title="Přesune vrstvu EXT do pozadí">EXT</button>';
       content += '<button id="DATAMAP" title="Přesune vrstvu DATAMAP do popředí">DATAMAP</button>';
       content += '&nbsp;&nbsp;&nbsp;';
       div.innerHTML = content;
       div.setAttribute('id', 'nazdar');
       return div;
       };
       
       layers_switch.addTo(map);*/
      $(document).ready(function () {
        var layersCount = 8;
        map.on('layeradd', function (e) {
          if (e.layer.hasOwnProperty('options') && e.layer.options.hasOwnProperty('layerName') && !e.layer.hasOwnProperty('_eventParents')) {
            layersCount--;
            if (layersCount == 0) {
              setTimeout(function () {
                Useky.bringToFront();
                ZTPRZ.bringToFront();
                ZTPPUB.bringToFront();
                ZAKAZ.bringToFront();
                SPEC.bringToFront();
                ZAS.bringToFront();
                DATAMAP.bringToBack();
                EXT.bringToBack();
          /*var lrs = {
           'Useky': Useky, 'ZTPRZ': ZTPRZ, 'ZTPPUB': ZTPPUB, 'ZAKAZ': ZAKAZ, 'SPEC': SPEC, 'ZAS': ZAS, 'DATAMAP': DATAMAP
           };
           L.control.layers({},lrs,{sortLayers: true}).addTo(map);        */
              }, 3000);              
              
              var lswitch = new L.Control.LayerSwitchButton({
                expanded: true,
                initialOrder: ['ZAS', 'SPEC', 'ZAKAZ', 'ZTPPUB', 'ZTPRZ', 'Useky', 'DATAMAP', 'EXT']
              });
              map.addControl(lswitch);

              /*L.Control.geocoder({
                placeholder: "Hledej adresu...",
                showResultIcons: true,
                errorMessage: 'Nic jsme nenašli...',
                position: 'bottomleft',
                //collapsed: false,
                geocoder: new L.Control.Geocoder.Nominatim({
                  geocodingQueryParams: {
                    "viewbox": "14.209442,50.179536,14.710007,49.934428",
                    "bounded": "1"
                  }
                })
              }).addTo(map);
              $('.leaflet-control-geocoder-icon').attr('title', 'Hledej adresu nebo souřadnice');*/
            }
          }
        });
        var legend = L.control({position: 'topright'});

        legend.onAdd = function (map) {
          var div = L.DomUtil.create('div', 'info legend');
          div.innerHTML += '<strong>' + title + '</strong><br>';
          div.innerHTML +=
                  '<span style="background:' + colors[0] + '"></span> ';
          for (var i = 0; i < grades.length; i++) {
            div.innerHTML +=
                    '<span style="background:' + colors[i + 1] + '"></span> ';
          }
          div.innerHTML += '<br>';

          if (SrcData != null)
            GeoDataSource = GeoDataPath + SrcData;
          for (var i = 0; i < grades.length; i++) {
            div.innerHTML +=
                    '<label>' + grades[i] + '</label>';

          }
          div.innerHTML += '<br>Zdrojová data:<strong> <a href=' + GeoDataSource + '>tsv</a> <a href=' + GeoDataFile + '>geojson</a></strong>';
          div.innerHTML += '<div class="popup-help-button" onclick="javascript:showLegendHelp(event);" style="outline: none;">?</div>';
          div.innerHTML += '<div id="legendHelp"><h3>Nápověda bohužel není k dispozici.</h3></div>';
          return div;
        };

        /* var topContainer = L.control({position: 'topleft'});
         topContainer.onAdd = function (map) {
         var div = L.DomUtil.create('div', 'topleft-container');
         var content = '';
         div.innerHTML = content;
         div.setAttribute('id', 'topleft-container');
         return div;
         };
         
         topContainer.addTo(map);*/

        legend.addTo(map);

        var fsControl = new L.Control.Fullscreen({
          title: {
            'false': 'Celá obrazovka !',
            'true': 'Normální zobrazení'
          },
          position: 'topleft'
        });
        /*var fsControl = L.control.fullscreen({
         position: 'topleft',
         title: 'Celá obrazovka !',
         titleCancel: 'Normální zobrazení',
         content: null,
         forceSeparateButton: true,
         });*/
        // add fullscreen control to the map
        map.addControl(fsControl);


          L.Control.geocoder({
                placeholder: "Hledej adresu...",
                showResultIcons: true,
                errorMessage: 'Nic jsme nenašli...',
                position: 'topleft',
                //collapsed: false,
                geocoder: new L.Control.Geocoder.Nominatim({
                  geocodingQueryParams: {
                    "viewbox": "14.209442,50.179536,14.710007,49.934428",
                    "bounded": "1"
                  }
                })
              }).addTo(map);
              $('.leaflet-control-geocoder-icon').attr('title', 'Hledej adresu nebo souřadnice');

        /*map.addControl( new L.Control.Search({
         url: 'https://nominatim.openstreetmap.org/search?addressdetails=1&viewbox=14.209442%2C50.179536%2C14.710007%2C49.934428&bounded=1&format=json&q={s}',
         jsonpParam: 'json_callback',
         propertyName: 'display_name',
         propertyLoc: ['lat','lon'],
         textPlaceholder: 'Hledej adresu',
         marker: L.circleMarker([0,0],{radius:30}),
         autoCollapse: true,
         autoType: false,
         minLength: 2
         }) );    */

        //map.addControl(L.control.zoom({ position: 'bottomright' }));

        if (XTitle != null)
          changeTitle(XTitle);
        if (XMC != null)
          changeTitle(XMC + ' ' + XTitle);
        if (clat != null)
          map.setView(new L.LatLng(clat, clon), 15);

        OSMpodklad.addTo(map);

        $.getJSON(
                GeoDataFile
                , function (data) {
                  DATAMAP.addData(data);
                });

        DATAMAP.addTo(map);             //zobraz DATAMAP

        /*document.getElementById("DATAMAP").addEventListener("click", function (event) {
         event.preventDefault();
         DATAMAP.bringToFront();
         });*/
        $.getJSON(
                "/zpsmap/ZPS256_ZAS.json"
                , function (data) {
                  ZAS.addData(data);
                });

        ZAS.addTo(map);             //zobraz ZAS

        /*document.getElementById("ZAS").addEventListener("click", function (event) {
         event.preventDefault();
         ZAS.bringToFront();
         });*/

        $.getJSON(
                "/zpsmap/ZPS255_SPEC.json"
                , function (data) {
                  SPEC.addData(data);
                });

        SPEC.addTo(map);             //zobraz SPEC

        /*document.getElementById("SPEC").addEventListener("click", function (event) {
         event.preventDefault();
         SPEC.bringToFront();
         });*/

        $.getJSON(
                "/zpsmap/ZPS254_ZM.json"
                , function (data) {
                  ZAKAZ.addData(data);
                });

        ZAKAZ.addTo(map);             //zobraz ZAKAZ

        /*document.getElementById("ZAKAZ").addEventListener("click", function (event) {
         event.preventDefault();
         ZAKAZ.bringToFront();
         });*/

        $.getJSON(
                "/zpsmap/ZPS253_ZTP-SDR.json"
                , function (data) {
                  ZTPPUB.addData(data);
                });

        //map.addLayer(ZTPPUB, true)
        ZTPPUB.addTo(map);             //zobraz ZTPPUB

        /*document.getElementById("ZTPPUB").addEventListener("click", function (event) {
         event.preventDefault();
         ZTPPUB.bringToFront();
         });*/

        $.getJSON(
                "/zpsmap/ZPS252_ZTP-RZ.json"
                , function (data) {
                  ZTPRZ.addData(data);
                });

        ZTPRZ.addTo(map);             //zobraz ZTPRZ

        /*document.getElementById("ZTPRZ").addEventListener("click", function (event) {
         event.preventDefault();
         ZTPRZ.bringToFront();
         });*/

        $.getJSON(//nacti Useky                  
                "/zpsmap/ZPS251_USEKY.json"
                , function (data) {
                  Useky.addData(data);
                });

        Useky.addTo(map);             //zobraz Useky

        /*document.getElementById("Useky").addEventListener("click", function (event) {
         event.preventDefault();
         Useky.bringToFront();
         });*/

        $.getJSON(//nacti Useky                  
                "/zpsmap/EXT.json"
                , function (data) {
                  EXT.addData(data);
                });

        EXT.addTo(map);             //zobraz Rozšíření

        /*document.getElementById("EXT").addEventListener("click", function (event) {
         event.preventDefault();
         EXT.bringToFront();
         });*/
        /*setTimeout(function () {
          Useky.bringToFront();
          ZTPRZ.bringToFront();
          ZTPPUB.bringToFront();
          ZAKAZ.bringToFront();
          SPEC.bringToFront();
          ZAS.bringToFront();
          DATAMAP.bringToBack();
          EXT.bringToBack();
        }, 3000);*/
        //3sec snad stačí
        var search_TARIFTAB_Ctrl = new L.Control.Search({
          layer: Useky,
          propertyName: 'TARIFTAB',
          textPlaceholder: 'Hledej Úsek',
          marker: false,
          moveToLocation: function (latlng, title, map) {
            map.setView(latlng, 19); // access the zoom
          }
        });

        search_TARIFTAB_Ctrl.on('search:locationfound', function (e) {
          if (e.layer._popup)
            e.layer.openPopup();
        }).on('search:collapsed', function (e) {
          Useky.eachLayer(function (layer) {	//restore feature color
            Useky.resetStyle(layer);
          });
        });

        map.addControl(search_TARIFTAB_Ctrl);  //inizialize search control

        var search_ZPS_ID_Ctrl = new L.Control.Search({
          layer: Useky,
          propertyName: 'ZPS_ID',
          textPlaceholder: 'Hledej Technický Úsek',
          marker: false,
          moveToLocation: function (latlng, title, map) {
            map.setView(latlng, 19); // access the zoom
          }
        });

        search_ZPS_ID_Ctrl.on('search:locationfound', function (e) {
          if (e.layer._popup)
            e.layer.openPopup();
        }).on('search:collapsed', function (e) {
          Useky.eachLayer(function (layer) {	//restore feature color
            Useky.resetStyle(layer);
          });
        });

        map.addControl(search_ZPS_ID_Ctrl);  //inizialize search control

        var XCode = 'CODE'
        var SRchCode = getURLParameter("SRchCode")
        if (SRchCode != null)
          XCode = SRchCode

        var search_CODE_Ctrl = new L.Control.Search({
          layer: DATAMAP,
          propertyName: XCode,
          textPlaceholder: 'Hledej ' + XCode,
          marker: false,
          moveToLocation: function (latlng, title, map) {
            map.setView(latlng, 19); // access the zoom
          }
        });

        search_CODE_Ctrl.on('search:locationfound', function (e) {
          if (e.layer._popup)
            e.layer.openPopup();
        }).on('search:collapsed', function (e) {
          Useky.eachLayer(function (layer) {	//restore feature color
            Useky.resetStyle(layer);
          });
        });

        map.addControl(search_CODE_Ctrl);  //inizialize search control

        /*var lswitch = new L.Control.LayerSwitchButton({
         expanded: true,
         initialOrder: ['ZAS','SPEC','ZAKAZ','ZTPPUB','ZTPRZ','Useky','DATAMAP','EXT']
         });
         map.addControl(lswitch);
         
         L.Control.geocoder({
         placeholder: "Hledej adresu...",
         showResultIcons: true,
         errorMessage: 'Nic jsme nenašli...',
         position: 'bottomleft',
         //collapsed: false,
         geocoder: new L.Control.Geocoder.Nominatim({
         geocodingQueryParams: {
         "viewbox": "14.209442,50.179536,14.710007,49.934428",
         "bounded": "1"
         }
         })
         }).addTo(map);
         $('.leaflet-control-geocoder-icon').attr('title', 'Hledej adresu nebo souřadnice');*/
      });

</script>


</div>  
